<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel - Bobby Mall</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{margin:0;background:#f4f6f8}

/* ===== LOGIN ===== */
.admin-login{
  max-width:360px;margin:100px auto;background:#fff;
  padding:30px;border-radius:12px;
  box-shadow:0 10px 25px rgba(0,0,0,.15)
}
.admin-login h2{text-align:center}
.admin-login input{
  width:100%;padding:12px;margin:10px 0;
  border-radius:8px;border:1px solid #ccc
}
.btn{
  width:100%;padding:12px;border:none;
  border-radius:8px;cursor:pointer;color:#fff
}
.btn-main{background:#ff5722}
.btn-grey{background:#999}
.btn-danger{background:#c62828}

/* ===== LAYOUT ===== */
.admin-wrapper{display:flex;min-height:100vh}

/* ===== SIDEBAR ===== */
.admin-sidebar{
  width:240px;
  background:linear-gradient(180deg,#0f2027,#203a43,#2c5364);
  color:#fff;padding:20px;
  display:flex;flex-direction:column
}
.sidebar-title{font-size:18px;margin:10px 0 20px}
.sidebar-btn{
  background:rgba(255,255,255,.1);
  color:#fff;border:none;
  padding:12px;margin:6px 0;
  border-radius:10px;text-align:left;
  cursor:pointer;transition:.3s
}
.sidebar-btn:hover{padding-left:16px}
.sidebar-btn.active{background:#ff5722}
.logout-btn{margin-top:auto;background:#b71c1c}

/* ===== MAIN ===== */
.admin-main{flex:1;padding:30px}

/* ===== ADD PRODUCT ===== */
.add-card{
  max-width:420px;margin:20px auto;
  background:#fff;padding:30px;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.15)
}
.add-card h3{text-align:center}
.add-card input,.add-card textarea{
  width:100%;padding:12px;margin:8px 0;
  border-radius:8px;border:1px solid #ccc
}
.preview-img{
  width:100%;height:160px;
  object-fit:cover;border-radius:10px;
  margin:10px 0;display:none
}

/* ===== PRODUCTS ===== */
.products-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:20px
}
.product-card{
  background:#fff;padding:15px;
  border-radius:14px;
  box-shadow:0 6px 18px rgba(0,0,0,.15);
  text-align:center
}
.product-card img{
  width:100%;height:150px;
  object-fit:cover;border-radius:10px
}
.edit-btn{background:#7b1fa2}
.delete-btn{background:#d32f2f}

/* ===== MODAL ===== */
.modal{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.6);z-index:999
}
.modal-box{
  background:#fff;width:90%;
  max-width:420px;
  margin:5% auto;padding:25px;
  border-radius:14px
}

/* ===== TOAST ===== */
.toast{
  position:fixed;bottom:20px;right:20px;
  background:#333;color:#fff;
  padding:12px 18px;border-radius:8px;
  display:none
}
.toast.show{display:block}

/* ===== MOBILE ===== */
@media(max-width:768px){
  .admin-wrapper{flex-direction:column}
  .admin-sidebar{width:100%}
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox" class="admin-login">
  <h2>Admin Login</h2>
  <input id="adminUsername" placeholder="Username">
  <input id="adminPassword" type="password" placeholder="Password">
  <button class="btn btn-main" onclick="login()">Login</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" style="display:none">
  <div class="admin-wrapper">

    <!-- SIDEBAR -->
    <div class="admin-sidebar">
      <a href="/" class="sidebar-btn">← Back to Home</a>
      <div class="sidebar-title">Admin Panel</div>

      <button id="btnAdd" class="sidebar-btn active" onclick="showAdd()">Add New Product</button>
      <button id="btnProducts" class="sidebar-btn" onclick="showProducts()">Products</button>
      <button id="btnOrders" class="sidebar-btn" onclick="showOrders()">Orders</button>

      <button class="sidebar-btn logout-btn" onclick="logout()">Logout</button>
    </div>

    <!-- MAIN -->
    <div class="admin-main">

      <!-- ADD PRODUCT -->
      <div id="addPage">
        <div class="add-card">
          <h3>Add New Product</h3>
          <form id="productForm">
            <input name="name" placeholder="Product Name" required>
            <input name="price" type="number" placeholder="Price" required>
            <input name="category" placeholder="Category" required>
            <input id="addImage" name="image" type="file" required>
            <img id="addPreview" class="preview-img">
            <button type="button" class="btn btn-grey" onclick="removeAddImage()">Cancel Image</button>
            <textarea name="description" placeholder="Description"></textarea>
            <button class="btn btn-main">Add Product</button>
          </form>
        </div>
      </div>

      <!-- PRODUCTS -->
      <div id="productsPage" style="display:none">
        <div class="products-grid" id="products"></div>
      </div>

      <!-- ORDERS -->
      <div id="ordersPage" style="display:none">
        <h2>Orders</h2>
        <div id="orders"></div>
      </div>

    </div>
  </div>
</div>

<!-- EDIT MODAL -->
<div class="modal" id="editModal">
  <div class="modal-box">
    <h3>Edit Product</h3>
    <img id="editPreview" class="preview-img">
    <input id="editName">
    <input id="editPrice" type="number">
    <input id="editCategory">
    <textarea id="editDesc"></textarea>
    <input id="editImage" type="file">
    <button class="btn btn-grey" onclick="removeEditImage()">Cancel Image</button>
    <button class="btn btn-main" onclick="updateProduct()">Update</button>
    <button class="btn btn-grey" onclick="closeEdit()">Cancel</button>
  </div>
</div>

<div class="toast" id="toast">Product Added</div>

<script>
const ADMIN_USER="admin",ADMIN_PASS="admin123";
let editId=null;

/* LOGIN */
function login(){
  if(adminUsername.value===ADMIN_USER && adminPassword.value===ADMIN_PASS){
    localStorage.setItem("admin","1");
    init();
  }
}
function init(){
  loginBox.style.display="none";
  dashboard.style.display="block";
  showAdd();
}
if(localStorage.getItem("admin")) init();

function logout(){
  localStorage.removeItem("admin");
  location.reload();
}

/* PAGE SWITCH */
function activate(btn){
  document.querySelectorAll(".sidebar-btn").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
}
function showAdd(){
  addPage.style.display="block";
  productsPage.style.display="none";
  ordersPage.style.display="none";
  activate(btnAdd);
}
function showProducts(){
  addPage.style.display="none";
  productsPage.style.display="block";
  ordersPage.style.display="none";
  activate(btnProducts);
  loadProducts();
}
function showOrders(){
  addPage.style.display="none";
  productsPage.style.display="none";
  ordersPage.style.display="block";
  activate(btnOrders);
  loadOrders();
}

/* IMAGE PREVIEW */
addImage.onchange=()=>preview(addImage,addPreview);
editImage.onchange=()=>preview(editImage,editPreview);
function preview(input,img){
  if(input.files[0]){
    img.src=URL.createObjectURL(input.files[0]);
    img.style.display="block";
  }
}
function removeAddImage(){addImage.value="";addPreview.style.display="none"}
function removeEditImage(){editImage.value="";editPreview.style.display="none"}

/* ADD PRODUCT */
productForm.onsubmit=e=>{
  e.preventDefault();
  fetch("/api/products",{method:"POST",body:new FormData(productForm)})
  .then(()=>{toast();productForm.reset();removeAddImage();});
};

/* LOAD PRODUCTS */
function loadProducts(){
  fetch("/api/products").then(r=>r.json()).then(data=>{
    products.innerHTML=data.map(p=>`
      <div class="product-card">
        <img src="${p.image}">
        <h4>${p.name}</h4>
        <p>₹${p.price}</p>
        <button class="btn edit-btn" onclick='openEdit("${p._id}","${p.name}","${p.price}","${p.category}","${p.description||""}","${p.image}")'>Edit</button>
        <button class="btn delete-btn" onclick="del('${p._id}')">Delete</button>
      </div>
    `).join("");
  });
}

/* EDIT */
function openEdit(id,n,p,c,d,img){
  editId=id;
  editName.value=n;
  editPrice.value=p;
  editCategory.value=c;
  editDesc.value=d;
  editPreview.src=img;
  editPreview.style.display="block";
  editModal.style.display="block";
}
function closeEdit(){editModal.style.display="none"}

function updateProduct(){
  const fd=new FormData();
  fd.append("name",editName.value);
  fd.append("price",editPrice.value);
  fd.append("category",editCategory.value);
  fd.append("description",editDesc.value);
  if(editImage.files[0])fd.append("image",editImage.files[0]);

  fetch("/api/products/"+editId,{method:"PUT",body:fd})
  .then(()=>{closeEdit();loadProducts();});
}

/* DELETE */
function del(id){
  if(confirm("Delete product?")){
    fetch("/api/products/"+id,{method:"DELETE"}).then(loadProducts);
  }
}

/* ORDERS */
function loadOrders(){
  fetch("/api/orders").then(r=>r.json()).then(data=>{
    orders.innerHTML=data.map(o=>`
      <div style="background:#fff;padding:15px;margin:10px;border-radius:10px">
        <b>Total:</b> ₹${o.total}<br>${o.address}
      </div>
    `).join("");
  });
}

/* TOAST */
function toast(){
  const t=document.getElementById("toast");
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2500);
}
</script>

</body>
</html>
